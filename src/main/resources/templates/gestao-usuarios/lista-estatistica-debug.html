<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>DEBUG - Lista Estatística</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <div class="alert alert-info">
            <h3>DEBUG - Lista Estatística de Usuários</h3>
            <p><strong>Instituição:</strong> <span th:text="${nomeInstituicao}">Não definido</span></p>
            <p><strong>Total Usuários:</strong> <span th:text="${totalUsuarios}">0</span></p>
        </div>

        <div class="alert alert-warning">
            <h4>Verificação dos Dados</h4>
            <p><strong>estatisticasPaises existe?</strong> 
                <span th:if="${estatisticasPaises != null}">✅ SIM</span>
                <span th:unless="${estatisticasPaises != null}">❌ NÃO</span>
            </p>
            <p><strong>estatisticasPaises é lista vazia?</strong> 
                <span th:if="${estatisticasPaises != null and #lists.isEmpty(estatisticasPaises)}">❌ SIM (VAZIA)</span>
                <span th:if="${estatisticasPaises != null and !#lists.isEmpty(estatisticasPaises)}">✅ NÃO (TEM DADOS)</span>
                <span th:unless="${estatisticasPaises != null}">⚠️ NÃO DEFINIDA</span>
            </p>
            <p><strong>Tamanho da lista:</strong> 
                <span th:if="${estatisticasPaises != null}" th:text="${#lists.size(estatisticasPaises)}">0</span>
                <span th:unless="${estatisticasPaises != null}">N/A</span>
            </p>
        </div>

        <div class="card" th:if="${estatisticasPaises != null and !#lists.isEmpty(estatisticasPaises)}">
            <div class="card-header">
                <h5>Dados dos Países</h5>
            </div>
            <div class="card-body">
                <ul class="list-group">
                    <li class="list-group-item" th:each="pais : ${estatisticasPaises}">
                        <strong th:text="${pais.nome}">País</strong> - 
                        <span th:text="${pais.quantidade}">0</span> usuários 
                        (<span th:text="${pais.percentual}">0</span>%)
                        
                        <ul class="mt-2" th:if="${pais.subNiveis != null}">
                            <li th:each="estado : ${pais.subNiveis}">
                                <strong th:text="${estado.nome}">Estado</strong> - 
                                <span th:text="${estado.quantidade}">0</span> usuários
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>

        <div class="alert alert-danger" th:if="${estatisticasPaises == null or #lists.isEmpty(estatisticasPaises)}">
            <h5>⚠️ PROBLEMA: Nenhum dado encontrado</h5>
            <p>A variável 'estatisticasPaises' não foi passada corretamente do controller.</p>
        </div>

        <div class="mt-3">
            <a href="/lista-estatistica-publica" class="btn btn-primary">Recarregar</a>
            <a href="/administrador/lista-usuarios" class="btn btn-secondary">Voltar</a>
        </div>
    </div>
</body>
</html>
