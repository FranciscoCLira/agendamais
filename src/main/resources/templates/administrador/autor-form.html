<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Editar Autor</title>
    <link rel="stylesheet" th:href="@{/css/estilo.css}" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <!-- CABEÇALHO PADRÃO -->
    <div th:replace="~{fragments/layout_cabecalho :: cabecalho}"></div>

    <!-- DEBUG: Exibir objeto autor e mensagens de erro -->
    <!-- 
    <div class="alert alert-info" th:if="${autor != null}">
      <strong>DEBUG autor:</strong>
      <pre th:text="${autor}"></pre>
    </div>
    -->

    <div
      class="alert alert-danger"
      th:if="${mensagemErro != null}"
      th:text="${mensagemErro}"
    ></div>

    <div
      class="d-flex justify-content-center align-items-center"
      style="min-height: 80vh; background: #f8f9fa"
    >
      <div class="card shadow" style="width: 100%; max-width: 650px">
        <div class="card-header bg-light">
          <h4 class="mb-0">
            <i class="fas fa-user-edit me-2"></i>
            EDITAR DADOS DE AUTOR
          </h4>
        </div>
        <div class="card-body">
          <form
            th:action="@{/administrador/autor-form/{id}(id=${autor.id},origem=${origem},filtroCodigo=${filtroCodigo},filtroNome=${filtroNome},filtroEmail=${filtroEmail},filtroSubInstituicao=${filtroSubInstituicao},filtroStatus=${filtroStatus},filtroPais=${filtroPais},filtroEstado=${filtroEstado},filtroCidade=${filtroCidade},size=${size},page=${page})}"
            th:object="${autor}"
            method="post"
          >
            <input type="hidden" th:field="*{id}" />
            <div class="row mb-3">
              <div class="col-sm-4">
                <label class="form-label"
                  ><strong>Participante Autor:</strong></label
                >
              </div>
              <div class="col-sm-8">
                <input
                  type="text"
                  th:field="*{pessoa.nomePessoa}"
                  readonly
                  tabindex="-1"
                  class="form-control fw-bold"
                  style="font-weight: bold"
                />
              </div>
            </div>

            <!-- Função do Autor -->
            <div class="row mb-3">
              <div class="col-sm-4">
                <label for="funcaoAutor" class="form-label"
                  ><strong>Função do Autor:</strong></label
                >
              </div>
              <div class="col-sm-8">
                <select
                  name="funcaoAutor"
                  id="funcaoAutor"
                  class="form-select"
                  onchange="toggleFuncaoOutra()"
                  autocomplete="off"
                >
                  <option value="">Selecione uma função</option>
                  <optgroup label="Funções Padrão">
                    <option
                      th:each="funcao : ${T(com.agendademais.enums.FuncaoAutor).values()}"
                      th:value="${funcao.name()}"
                      th:text="${funcao.descricao}"
                      th:selected="${autor.funcaoAutor != null and autor.funcaoAutor.name() == funcao.name()}"
                    ></option>
                  </optgroup>
                  <optgroup
                    label="Funções Personalizadas"
                    th:if="${funcoesPersonalizadas != null and !funcoesPersonalizadas.empty}"
                  >
                    <option
                      th:each="funcaoCustom : ${funcoesPersonalizadas}"
                      th:value="'CUSTOM_' + ${funcaoCustom.id}"
                      th:text="${funcaoCustom.nomeFuncao}"
                      th:selected="${autor.funcaoAutorCustomizada != null and autor.funcaoAutorCustomizada.id == funcaoCustom.id}"
                    ></option>
                  </optgroup>
                </select>
              </div>
            </div>
            <!-- Campo para especificar "Outra" função -->
            <div class="row mb-3" id="funcaoOutraDiv" style="display: none">
              <script>
                document.addEventListener("DOMContentLoaded", function () {
                  toggleFuncaoOutra();
                });
                function toggleFuncaoOutra() {
                  const select = document.getElementById("funcaoAutor");
                  const divOutra = document.getElementById("funcaoOutraDiv");
                  const inputOutra =
                    document.getElementById("funcaoAutorOutra");
                  if (select && divOutra && inputOutra) {
                    if (select.value === "OUTRA") {
                      divOutra.style.display = "flex";
                      inputOutra.required = true;
                    } else {
                      divOutra.style.display = "none";
                      inputOutra.required = false;
                      if (!select.value.startsWith("CUSTOM_")) {
                        inputOutra.value = "";
                      }
                    }
                  }
                }
              </script>
              <div class="col-sm-4">
                <label for="funcaoAutorOutra" class="form-label"
                  ><strong>Especifique a Função:</strong></label
                >
              </div>
              <div class="col-sm-8">
                <input
                  type="text"
                  th:field="*{funcaoAutorOutra}"
                  id="funcaoAutorOutra"
                  class="form-control"
                  placeholder="Ex: Conferencista Principal, Moderador de Mesa Redonda, etc."
                  maxlength="100"
                />
                <div class="form-text">
                  Especifique sua função quando selecionada a opção "Outra".
                </div>
              </div>
            </div>

            <!-- Situação do Autor -->
            <div class="row mb-3">
              <div class="col-sm-4">
                <label for="situacaoAutor" class="form-label"
                  ><strong>Situação do Autor:</strong></label
                >
              </div>
              <div class="col-sm-8">
                <select
                  th:field="*{situacaoAutor}"
                  id="situacaoAutor"
                  class="form-select"
                >
                  <option value="A" th:selected="${autor.situacaoAutor == 'A'}">
                    Ativo
                  </option>
                  <option value="I" th:selected="${autor.situacaoAutor == 'I'}">
                    Inativo
                  </option>
                </select>
              </div>
            </div>

            <!-- Currículo da Função -->
            <div class="row mb-3">
              <div class="col-sm-4">
                <label for="curriculoFuncaoAutor" class="form-label"
                  ><strong>Currículo da Função:</strong></label
                >
              </div>
              <div class="col-sm-8">
                <textarea
                  th:field="*{curriculoFuncaoAutor}"
                  id="curriculoFuncaoAutor"
                  class="form-control"
                  rows="5"
                  placeholder="Descreva as informações relevantes a sua função de autor"
                ></textarea>
              </div>
            </div>

            <!-- Link da Imagem -->
            <div class="row mb-3">
              <div class="col-sm-4">
                <label for="linkImgAutor" class="form-label"
                  ><strong>Link da Imagem:</strong></label
                >
              </div>
              <div class="col-sm-8">
                <input
                  type="url"
                  th:field="*{linkImgAutor}"
                  id="linkImgAutor"
                  class="form-control"
                  placeholder="https://exemplo.com/minha-foto.jpg"
                />
                <div class="form-text">
                  URL para uma foto sua que será exibida em perfis e
                  apresentações.
                </div>
              </div>
            </div>

            <!-- Link do Material -->
            <div class="row mb-3">
              <div class="col-sm-4">
                <label for="linkMaterialAutor" class="form-label"
                  ><strong>Link do Material:</strong></label
                >
              </div>
              <div class="col-sm-8">
                <input
                  type="url"
                  th:field="*{linkMaterialAutor}"
                  id="linkMaterialAutor"
                  class="form-control"
                  placeholder="https://exemplo.com/meus-materiais"
                />
                <div class="form-text">
                  URL para um site, blog ou repositório com seus materiais e
                  trabalhos.
                </div>
              </div>
            </div>

            <!-- Data Última Atualização (protegido) -->
            <div class="row mb-3">
              <div class="col-sm-4">
                <label class="form-label"
                  ><strong>Data Última Atualização:</strong></label
                >
              </div>
              <div class="col-sm-8">
                <input
                  type="text"
                  class="form-control bg-light"
                  style="background: #e9ecef"
                  th:value="${autor.dataUltimaAtualizacao != null ? #temporals.format(autor.dataUltimaAtualizacao, 'dd/MM/yyyy') : ''}"
                  readonly
                />
              </div>
            </div>

            <div class="d-flex justify-content-end gap-2 mt-4">
              <button type="submit" class="btn btn-success">
                <i class="fas fa-save me-2"></i>Salvar
              </button>
              <a
                th:href="@{/administrador/usuarios(
                  filtroCodigo=${filtroCodigo},
                  filtroNome=${filtroNome},
                  filtroEmail=${filtroEmail},
                  filtroSubInstituicao=${filtroSubInstituicao},
                  filtroStatus=${filtroStatus},
                  filtroPais=${filtroPais},
                  filtroEstado=${filtroEstado},
                  filtroCidade=${filtroCidade},
                  size=${size},
                  page=${page}
                )}"
                class="btn btn-secondary"
                >Cancelar</a
              >
            </div>
          </form>
        </div>
      </div>
    </div>
  </body>
</html>
