<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Editar Local - Agenda Mais</title>
    <link rel="stylesheet" th:href="@{/css/estilo.css}" />
    <style>
      .edit-container {
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        padding-top: 30px; /* Espa√ßo adicional para o cabe√ßalho fixo */
      }
      .form-card {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .form-grid {
        display: grid;
        gap: 20px;
      }
      .form-row {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 15px;
        align-items: center;
      }
      .form-row label {
        font-weight: bold;
        text-align: right;
      }
      .form-row input,
      .form-row select {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
      }
      .tipo-info {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #6f42c1;
        margin-bottom: 20px;
      }
      .hierarquia-info {
        background: #e7f3ff;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #007bff;
        margin-bottom: 20px;
      }
      .btn-group {
        text-align: center;
        margin-top: 30px;
      }
      .btn-group button,
      .btn-group a {
        margin: 0 10px;
      }
      .revisao-section {
        background: #fff3cd;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #ffc107;
      }
      .readonly-field {
        background: #f8f9fa;
        color: #6c757d;
      }
    </style>
  </head>
  <body>
    <div th:replace="fragments/layout_cabecalho :: cabecalho"></div>

    <div class="edit-container">
      <h1>‚úèÔ∏è Editar Local</h1>

      <!-- Mensagens -->
      <div
        th:if="${mensagemSucesso}"
        class="alert alert-success"
        th:text="${mensagemSucesso}"
      ></div>
      <div
        th:if="${mensagemErro}"
        class="alert alert-error"
        th:text="${mensagemErro}"
      ></div>

      <!-- Informa√ß√µes do tipo de local -->
      <div class="tipo-info">
        <h3>üìç Tipo de Local</h3>
        <p th:switch="${local.tipoLocal}">
          <span th:case="1"
            ><strong>üåç Pa√≠s</strong> - Local de n√≠vel superior na
            hierarquia</span
          >
          <span th:case="2"
            ><strong>üèõÔ∏è Estado/Prov√≠ncia</strong> - Subdivis√£o de um pa√≠s</span
          >
          <span th:case="3"
            ><strong>üèòÔ∏è Cidade/Munic√≠pio</strong> - Subdivis√£o de um
            estado</span
          >
        </p>
      </div>

      <!-- Informa√ß√µes hier√°rquicas -->
      <div class="hierarquia-info" th:if="${local.localPai != null}">
        <h3>üîó Hierarquia</h3>
        <p>
          <strong>Local Pai:</strong>
          <span th:text="${local.localPai.nomeLocal}"></span>
          <span th:if="${local.localPai.localPai != null}">
            ‚Üí <span th:text="${local.localPai.localPai.nomeLocal}"></span>
          </span>
        </p>
      </div>

      <div class="form-card">
        <form
          th:action="@{/gestao/locais/editar/{id}(id=${local.id})}"
          method="post"
        >
          <div class="form-grid">
            <!-- ID (readonly) -->
            <div class="form-row">
              <label>ID:</label>
              <input
                type="text"
                th:value="${local.id}"
                readonly
                class="readonly-field"
              />
            </div>

            <!-- Tipo (readonly) -->
            <div class="form-row">
              <label>Tipo:</label>
              <input
                type="text"
                readonly
                class="readonly-field"
                th:value="${local.tipoLocal == 1 ? 'Pa√≠s' : (local.tipoLocal == 2 ? 'Estado' : 'Cidade')}"
              />
            </div>

            <!-- Nome do local -->
            <div class="form-row">
              <label for="nomeLocal">Nome: *</label>
              <input
                type="text"
                id="nomeLocal"
                name="nomeLocal"
                th:value="${local.nomeLocal}"
                required
                maxlength="100"
                placeholder="Digite o nome do local"
              />
            </div>

            <!-- Local Pai (se aplic√°vel) -->
            <div class="form-row" th:if="${local.tipoLocal > 1}">
              <label for="idPai">
                <span
                  th:text="${local.tipoLocal == 2 ? 'Pa√≠s:' : 'Estado:'}"
                ></span>
              </label>
              <select
                id="idPai"
                name="idPai"
                required
                th:if="${local.tipoLocal == 2}"
              >
                <option value="">Selecione o pa√≠s</option>
                <option
                  th:each="pais : ${paises}"
                  th:value="${pais.id}"
                  th:text="${pais.nomeLocal}"
                  th:selected="${local.localPai != null and local.localPai.id == pais.id}"
                ></option>
              </select>
              <select
                id="idPai"
                name="idPai"
                required
                th:if="${local.tipoLocal == 3}"
              >
                <option value="">Selecione o estado</option>
                <option
                  th:each="estado : ${estados}"
                  th:value="${estado.id}"
                  th:text="${estado.nomeLocal}"
                  th:selected="${local.localPai != null and local.localPai.id == estado.id}"
                ></option>
              </select>
            </div>

            <!-- Data de cria√ß√£o/atualiza√ß√£o (readonly) -->
            <div class="form-row">
              <label>√öltima Atualiza√ß√£o:</label>
              <input
                type="text"
                th:value="${#temporals.format(local.dataUltimaAtualizacao, 'dd/MM/yyyy')}"
                readonly
                class="readonly-field"
              />
            </div>
          </div>

          <!-- Se√ß√£o de Revis√£o -->
          <div class="revisao-section">
            <h3>‚úÖ Controle de Revis√£o</h3>
            <p>
              Marque como "Revisado" quando o nome e hierarquia do local
              estiverem corretos e validados.
            </p>

            <div class="form-row">
              <label for="revisadoLocal">Status de Revis√£o:</label>
              <select id="revisadoLocal" name="revisadoLocal" required>
                <option value="n" th:selected="${local.revisadoLocal == 'n'}">
                  ‚ùå N√£o Revisado
                </option>
                <option value="s" th:selected="${local.revisadoLocal == 's'}">
                  ‚úÖ Revisado
                </option>
              </select>
            </div>
          </div>

          <!-- Bot√µes -->
          <div class="btn-group">
            <button
              type="submit"
              onclick="return confirm('Confirma as altera√ß√µes?')"
            >
              üíæ Salvar Altera√ß√µes
            </button>
            <a href="/gestao/locais" class="btn btn-secondary">
              ‚Üê Voltar √† Lista
            </a>
          </div>
        </form>
      </div>

      <!-- Informa√ß√µes de ajuda -->
      <div
        style="
          margin-top: 30px;
          padding: 20px;
          background: #f8f9fa;
          border-radius: 8px;
        "
      >
        <h4>üí° Dicas de Edi√ß√£o</h4>
        <ul>
          <li>
            <strong>Nome:</strong> Use a grafia oficial e padr√£o do local (ex:
            "S√£o Paulo", n√£o "Sao Paulo")
          </li>
          <li>
            <strong>Hierarquia:</strong> A hierarquia n√£o pode ser alterada.
            Para mover um local, entre em contato com o administrador do
            sistema.
          </li>
          <li>
            <strong>Revis√£o:</strong> Marque como "Revisado" apenas quando tiver
            certeza de que as informa√ß√µes est√£o corretas.
          </li>
          <li>
            <strong>Duplicatas:</strong> O sistema impede a cria√ß√£o de locais
            duplicados no mesmo n√≠vel hier√°rquico.
          </li>
        </ul>
      </div>
    </div>

    <script>
      // Se √© cidade, carrega estados via AJAX quando pa√≠s mudar
      document.addEventListener("DOMContentLoaded", function () {
        const paisSelect = document.getElementById("paisSelect");
        const estadoSelect = document.getElementById("estadoSelect");

        if (paisSelect && estadoSelect) {
          paisSelect.addEventListener("change", function () {
            const paisId = this.value;
            if (paisId) {
              fetch(`/gestao/locais/api/estados/${paisId}`)
                .then((response) => response.json())
                .then((estados) => {
                  estadoSelect.innerHTML =
                    '<option value="">Selecione o estado</option>';
                  estados.forEach((estado) => {
                    estadoSelect.innerHTML += `<option value="${estado.id}">${estado.nomeLocal}</option>`;
                  });
                })
                .catch((error) => {
                  console.error("Erro ao carregar estados:", error);
                  estadoSelect.innerHTML =
                    '<option value="">Erro ao carregar estados</option>';
                });
            } else {
              estadoSelect.innerHTML =
                '<option value="">Selecione o estado</option>';
            }
          });
        }
      });
    </script>
  </body>
</html>
