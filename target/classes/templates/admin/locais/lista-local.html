<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Administra√ß√£o de Locais - Agenda Mais</title>
    <link rel="stylesheet" th:href="@{/css/estilo.css}" />
    <style>
      .admin-container {
        max-width: 1200px;
        margin: 20px auto;
        paddin      <!-- Bot√µes de Navega√ß√£o -->
      <div style="margin-top: 30px; text-align: center">
        <a href="/menus/menu-controle-total" class="btn btn-secondary"
          >‚Üê Voltar ao Menu Controle Total</a
        >px;
        padding-top: 30px; /* Espa√ßo adicional para o cabe√ßalho fixo */
      }
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
      }
      .stat-card {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        border-left: 4px solid #6f42c1;
      }
      .stat-number {
        font-size: 2em;
        font-weight: bold;
        color: #6f42c1;
      }
      .filters {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      .filters-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        align-items: end;
      }
      .table-container {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .local-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
      }
      .local-table th,
      .local-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }
      .local-table th {
        background: #6f42c1;
        color: white;
        position: sticky;
        top: 0;
      }
      .local-table tr:hover {
        background: #f8f9fa;
      }
      .tipo-badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.85em;
        font-weight: bold;
      }
      .tipo-pais {
        background: #007bff;
        color: white;
      }
      .tipo-estado {
        background: #28a745;
        color: white;
      }
      .tipo-cidade {
        background: #ffc107;
        color: black;
      }
      .revisado-sim {
        color: #28a745;
        font-weight: bold;
      }
      .revisado-nao {
        color: #dc3545;
        font-weight: bold;
      }
      .pagination {
        margin-top: 20px;
        text-align: center;
      }
      .pagination a,
      .pagination span {
        display: inline-block;
        padding: 8px 12px;
        margin: 0 2px;
        border: 1px solid #ddd;
        text-decoration: none;
        color: #6f42c1;
      }
      .pagination .current {
        background: #6f42c1;
        color: white;
      }
      .btn-group {
        margin-bottom: 15px;
      }
      .btn-group button,
      .btn-group a {
        margin-right: 10px;
      }
      .action-buttons {
        white-space: nowrap;
      }
      .action-buttons a {
        margin-right: 5px;
      }
    </style>
  </head>
  <body>
    <div th:replace="fragments/layout_cabecalho :: cabecalho"></div>

    <div class="admin-container">
      <h1>üåç Administra√ß√£o de Locais</h1>
      <p class="subtitle">Gest√£o de pa√≠ses, estados e cidades do sistema</p>

      <!-- Filtro ativo -->
      <div
        th:if="${filtroAtivo != null and !filtroAtivo.empty}"
        style="
          background: #e8f5e8;
          padding: 15px;
          border-radius: 8px;
          margin-bottom: 20px;
          border-left: 4px solid #28a745;
        "
      >
        <strong>üîç Filtro Ativo:</strong> <span th:text="${filtroAtivo}"></span>
        <a href="/gestao/locais" style="margin-left: 15px; color: #dc3545"
          >‚ùå Remover Filtro</a
        >
      </div>

      <!-- Mensagens -->
      <div
        th:if="${mensagemSucesso}"
        class="alert alert-success"
        th:text="${mensagemSucesso}"
      ></div>
      <div
        th:if="${mensagemErro}"
        class="alert alert-error"
        th:text="${mensagemErro}"
      ></div>

      <!-- Estat√≠sticas -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number" th:text="${totalLocais}">0</div>
          <div>Total de Locais</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" th:text="${totalPaises}">0</div>
          <div>Pa√≠ses</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" th:text="${totalEstados}">0</div>
          <div>Estados</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" th:text="${totalCidades}">0</div>
          <div>Cidades</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" th:text="${locaisNaoRevisados}">0</div>
          <div>N√£o Revisados</div>
        </div>
      </div>

      <!-- Filtros -->
      <div class="filters">
        <h3>üîç Filtros</h3>
        <form method="get" action="/gestao/locais">
          <div class="filters-grid">
            <div>
              <label>Tipo:</label>
              <select name="tipoLocal">
                <option value="">Todos</option>
                <option value="1" th:selected="${tipoLocal == 1}">Pa√≠s</option>
                <option value="2" th:selected="${tipoLocal == 2}">
                  Estado
                </option>
                <option value="3" th:selected="${tipoLocal == 3}">
                  Cidade
                </option>
              </select>
            </div>
            <div>
              <label>Nome cont√©m:</label>
              <input
                type="text"
                name="nomeLocal"
                th:value="${nomeLocal}"
                placeholder="Digite parte do nome..."
              />
            </div>
            <div>
              <label>Estados do Pa√≠s:</label>
              <select name="paisId">
                <option value="">Selecione um pa√≠s</option>
                <option
                  th:each="pais : ${paises}"
                  th:value="${pais.id}"
                  th:text="${pais.nomeLocal}"
                  th:selected="${paisId != null and paisId == pais.id}"
                ></option>
              </select>
            </div>
            <div>
              <label>Revisado:</label>
              <select name="revisadoLocal">
                <option value="">Todos</option>
                <option value="s" th:selected="${revisadoLocal == 's'}">
                  Sim
                </option>
                <option value="n" th:selected="${revisadoLocal == 'n'}">
                  N√£o
                </option>
              </select>
            </div>
            <div>
              <button type="submit">üîç Filtrar</button>
              <a href="/gestao/locais" class="btn btn-secondary">üîÑ Limpar</a>
            </div>
          </div>

          <!-- Campos ocultos para manter ordena√ß√£o -->
          <input type="hidden" name="sortBy" th:value="${sortBy}" />
          <input type="hidden" name="sortDir" th:value="${sortDir}" />
        </form>
      </div>

      <!-- A√ß√µes em lote -->
      <div class="btn-group">
        <a href="/gestao/locais/hierarquia" class="btn btn-secondary">
          üåê Vista Hier√°rquica
        </a>
        <button type="button" onclick="selecionarTodos()">
          ‚òëÔ∏è Selecionar Todos
        </button>
        <button type="button" onclick="limparSelecao()">
          ‚òê Limpar Sele√ß√£o
        </button>
        <button type="button" onclick="revisarSelecionados()">
          ‚úÖ Marcar Selecionados como Revisados
        </button>
      </div>

      <!-- Tabela de Locais -->
      <div class="table-container">
        <h3>üìã Locais Cadastrados</h3>

        <!-- Formul√°rio para marcar m√∫ltiplos como revisados -->
        <form
          method="post"
          action="/gestao/locais/revisar-multiplos"
          id="formRevisarMultiplos"
        >
          <!-- Tabela de locais -->
          <table class="local-table">
            <thead>
              <tr>
                <th style="width: 40px">
                  <input type="checkbox" id="selectAll" />
                </th>
                <!-- ID oculto para melhor UX
                <th style="width: 80px">
                  <a
                    th:href="@{/gestao/locais(sortBy='id', sortDir=${sortBy == 'id' and sortDir == 'asc' ? 'desc' : 'asc'}, tipoLocal=${tipoLocal}, nomeLocal=${nomeLocal}, revisadoLocal=${revisadoLocal})}"
                    style="color: white; text-decoration: none"
                    >ID
                    <span
                      th:if="${sortBy == 'id'}"
                      th:text="${sortDir == 'asc' ? '‚Üë' : '‚Üì'}"
                    ></span>
                  </a>
                </th>
                -->
                <th style="width: 100px">
                  <a
                    th:href="@{/gestao/locais(sortBy='tipoLocal', sortDir=${sortBy == 'tipoLocal' and sortDir == 'asc' ? 'desc' : 'asc'}, tipoLocal=${tipoLocal}, nomeLocal=${nomeLocal}, revisadoLocal=${revisadoLocal})}"
                    style="color: white; text-decoration: none"
                    >Tipo
                    <span
                      th:if="${sortBy == 'tipoLocal'}"
                      th:text="${sortDir == 'asc' ? '‚Üë' : '‚Üì'}"
                    ></span>
                  </a>
                </th>
                <th>
                  <a
                    th:href="@{/gestao/locais(sortBy='nomeLocal', sortDir=${sortBy == 'nomeLocal' and sortDir == 'asc' ? 'desc' : 'asc'}, tipoLocal=${tipoLocal}, nomeLocal=${nomeLocal}, revisadoLocal=${revisadoLocal})}"
                    style="color: white; text-decoration: none"
                    >Nome
                    <span
                      th:if="${sortBy == 'nomeLocal'}"
                      th:text="${sortDir == 'asc' ? '‚Üë' : '‚Üì'}"
                    ></span>
                  </a>
                </th>
                <th style="width: 120px">Local Pai</th>
                <th style="width: 100px">
                  <a
                    th:href="@{/gestao/locais(sortBy='revisadoLocal', sortDir=${sortBy == 'revisadoLocal' and sortDir == 'asc' ? 'desc' : 'asc'}, tipoLocal=${tipoLocal}, nomeLocal=${nomeLocal}, revisadoLocal=${revisadoLocal})}"
                    style="color: white; text-decoration: none"
                    >Revisado
                    <span
                      th:if="${sortBy == 'revisadoLocal'}"
                      th:text="${sortDir == 'asc' ? '‚Üë' : '‚Üì'}"
                    ></span>
                  </a>
                </th>
                <th style="width: 120px">
                  <a
                    th:href="@{/gestao/locais(sortBy='dataUltimaAtualizacao', sortDir=${sortBy == 'dataUltimaAtualizacao' and sortDir == 'asc' ? 'desc' : 'asc'}, tipoLocal=${tipoLocal}, nomeLocal=${nomeLocal}, revisadoLocal=${revisadoLocal})}"
                    style="color: white; text-decoration: none"
                    >√öltima Atualiza√ß√£o
                    <span
                      th:if="${sortBy == 'dataUltimaAtualizacao'}"
                      th:text="${sortDir == 'asc' ? '‚Üë' : '‚Üì'}"
                    ></span>
                  </a>
                </th>
                <th style="width: 80px">A√ß√µes</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="local : ${locais}">
                <td>
                  <input
                    type="checkbox"
                    name="ids"
                    th:value="${local.id}"
                    class="select-item"
                  />
                </td>
                <!-- ID oculto para melhor UX
                <td th:text="${local.id}"></td>
                -->
                <td>
                  <span th:switch="${local.tipoLocal}">
                    <span th:case="1" class="tipo-badge tipo-pais">Pa√≠s</span>
                    <span th:case="2" class="tipo-badge tipo-estado"
                      >Estado</span
                    >
                    <span th:case="3" class="tipo-badge tipo-cidade"
                      >Cidade</span
                    >
                  </span>
                </td>
                <td th:text="${local.nomeLocal}"></td>
                <td
                  th:text="${local.localPai != null ? local.localPai.nomeLocal : '-'}"
                ></td>
                <td>
                  <span
                    th:class="${local.revisadoLocal == 's' ? 'revisado-sim' : 'revisado-nao'}"
                    th:text="${local.revisadoLocal == 's' ? 'SIM' : 'N√ÉO'}"
                  ></span>
                </td>
                <td
                  th:text="${#temporals.format(local.dataUltimaAtualizacao, 'dd/MM/yyyy')}"
                ></td>
                <td class="action-buttons">
                  <a
                    th:href="@{/gestao/locais/editar/{id}(id=${local.id})}"
                    class="btn-edit"
                    title="Editar local"
                    >‚úèÔ∏è Editar</a
                  >
                </td>
              </tr>
              <tr th:if="${#lists.isEmpty(locais)}">
                <td colspan="7" style="text-align: center; padding: 40px">
                  üîç Nenhum local encontrado com os filtros aplicados.
                </td>
              </tr>
            </tbody>
          </table>
        </form>

        <!-- Pagina√ß√£o -->
        <div class="pagination" th:if="${page.totalPages > 1}">
          <a
            th:if="${page.hasPrevious()}"
            th:href="@{/gestao/locais(page=${page.number - 1}, tipoLocal=${tipoLocal}, nomeLocal=${nomeLocal}, revisadoLocal=${revisadoLocal}, sortBy=${sortBy}, sortDir=${sortDir})}"
          >
            ‚Üê Anterior
          </a>

          <span th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}">
            <a
              th:if="${i != page.number}"
              th:href="@{/gestao/locais(page=${i}, tipoLocal=${tipoLocal}, nomeLocal=${nomeLocal}, revisadoLocal=${revisadoLocal}, sortBy=${sortBy}, sortDir=${sortDir})}"
              th:text="${i + 1}"
            ></a>
            <span
              th:if="${i == page.number}"
              class="current"
              th:text="${i + 1}"
            ></span>
          </span>

          <a
            th:if="${page.hasNext()}"
            th:href="@{/gestao/locais(page=${page.number + 1}, tipoLocal=${tipoLocal}, nomeLocal=${nomeLocal}, revisadoLocal=${revisadoLocal}, sortBy=${sortBy}, sortDir=${sortDir})}"
          >
            Pr√≥xima ‚Üí
          </a>
        </div>

        <div class="pagination-info">
          <p>
            Mostrando
            <strong th:text="${page.size * page.number + 1}">1</strong> a
            <strong th:text="${page.size * page.number + page.numberOfElements}"
              >20</strong
            >
            de <strong th:text="${page.totalElements}">100</strong> locais
          </p>
        </div>
      </div>

      <!-- Bot√µes de Navega√ß√£o -->
      <div style="margin-top: 30px; text-align: center">
        <a href="/menus/menu-controle-total" class="btn btn-secondary"
          >‚Üê Voltar ao Menu Controle Total</a
        >
      </div>
    </div>

    <script>
      function toggleAll() {
        const selectAll = document.getElementById("selectAll");
        const items = document.querySelectorAll(".select-item");
        items.forEach((item) => (item.checked = selectAll.checked));
      }

      function selecionarTodos() {
        document.getElementById("selectAll").checked = true;
        toggleAll();
      }

      function limparSelecao() {
        document.getElementById("selectAll").checked = false;
        toggleAll();
      }

      function revisarSelecionados() {
        const selecionados = document.querySelectorAll(".select-item:checked");
        if (selecionados.length === 0) {
          alert("Selecione pelo menos um local para revisar.");
          return;
        }

        if (
          confirm(`Marcar ${selecionados.length} local(is) como revisado(s)?`)
        ) {
          // Coletar IDs selecionados
          const ids = Array.from(selecionados).map(
            (checkbox) => checkbox.value
          );

          // Construir URL GET com os IDs
          let url = "/gestao/locais/revisar-multiplos?";
          ids.forEach((id) => {
            url += "ids=" + encodeURIComponent(id) + "&";
          });

          // Redirecionar para a URL
          window.location.href = url;
        }
      }
    </script>
  </body>
</html>
