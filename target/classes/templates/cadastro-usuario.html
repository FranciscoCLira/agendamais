<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Cadastro de Novo Usu√°rio</title>
    <link rel="stylesheet" th:href="@{/css/estilo.css}" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />
    <style>
      .form-container {
        max-width: 400px;
        margin: auto;
        background: #fff;
        padding: 20px;
        border-radius: 8px;
      }
      .mensagem-erro {
        color: red;
        font-weight: bold;
        text-align: center;
        margin-bottom: 15px;
      }
      .mensagem-sucesso {
        color: green;
        font-weight: bold;
        text-align: center;
        margin-bottom: 15px;
      }
      .header-user-info {
        text-align: right;
        padding: 10px;
        background: #f5f5f5;
        margin-bottom: 10px;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <!-- Mostra informa√ß√µes do usu√°rio logado apenas se houver sess√£o ativa -->
    <div th:if="${session.usuarioLogado}" class="header-user-info">
      <strong>Usu√°rio:</strong>
      <span th:text="${session.usuarioLogado.username}"></span>
      <span th:if="${session.usuarioLogado.pessoa}">
        | <span th:text="${session.usuarioLogado.pessoa.nomePessoa}"></span>
      </span>
      | <a href="/acesso/logout">Sair</a>
    </div>

    <header class="cabecalho">
      <div class="titulo">
        <h1>Agenda Mais</h1>
        <h3>Agendando tudo e mais</h3>
      </div>
      <div class="logo">
        <img src="/images/logo-mistico.svg" alt="Logo" style="height: 40px" />
      </div>
    </header>

    <div class="form-container">
      <h2>Cadastro de Novo Usu√°rio</h2>

      <!-- Melhor identifica√ß√£o de erros espec√≠ficos -->
      <div th:if="${mensagemErro}" class="mensagem-erro">
        <i class="fas fa-exclamation-triangle"></i>
        <span th:utext="${mensagemErro}"></span>
      </div>
      <div th:if="${mensagemSucesso}" class="mensagem-sucesso">
        <i class="fas fa-check-circle"></i>
        <span th:text="${mensagemSucesso}"></span>
      </div>

      <form th:action="@{/cadastro-usuario}" method="post">
        <label>Novo C√≥digo do Usu√°rio:</label>
        <input
          type="text"
          name="username"
          maxlength="25"
          th:value="${username != null ? username : (usuario != null ? usuario.username : '')}"
          placeholder="M√≠nimo 6 caracteres"
          required
        />

        <label>Senha:</label>
        <input
          type="password"
          name="password"
          th:value="${password != null ? password : ''}"
          placeholder="M√≠nimo 6 caracteres, com letras e n√∫meros/s√≠mbolos"
          required
        />
        <span class="toggle-password" onclick="togglePassword(this)">üëÅÔ∏è</span>

        <label>Confirmar Senha:</label>
        <input
          type="password"
          name="confirmPassword"
          placeholder="Digite a senha novamente"
          required
        />
        <span class="toggle-password" onclick="togglePassword(this)">üëÅÔ∏è</span>

        <button type="submit">Avan√ßar</button>
      </form>

      <div style="text-align: center; margin-top: 10px">
        <!-- Adapta√ß√£o: volta para diferentes lugares dependendo do contexto -->
        <a
          th:href="${origem == 'administrador' ? '/administrador' : 
                   origem == 'superusuario' ? '/superusuario' : 
                   session.usuarioLogado != null ? '/participante' : '/acesso'}"
        >
          <button
            type="button"
            th:text="${session.usuarioLogado != null ? 'Voltar ao Menu' : 'Voltar ao Login'}"
          ></button>
        </a>
      </div>
    </div>

    <script>
      function togglePassword(el) {
        const input = el.previousElementSibling;
        if (input.type === "password") {
          input.type = "text";
        } else {
          input.type = "password";
        }
      }
    </script>
  </body>
</html>
